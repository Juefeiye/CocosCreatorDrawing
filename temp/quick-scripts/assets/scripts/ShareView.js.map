{"version":3,"sources":["ShareView.js"],"names":["cc","Class","extends","Component","properties","shot","Sprite","shotIndex","onLoad","screenShot","callback","screenshot","node","addComponent","sys","isBrowser","onbtn_web","CC_JSB","onBtn_native","screenshotCanvas","base64","frame","spriteFrame","name","toString","screenshotNative","hidden","active","shareToPlatform","t","type","Tool","onEvent","window","system","go","fileName","fullPath","jsb","fileUtils","getWritablePath","info","JSON","stringify","result","reflection","callStaticMethod","kf","self","saveImageToLocal","imagePath","shareByClient","saveToAlbum","saveImageToAlbum","length","toast"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,cAAML,GAAGM,MADD;AAERC,mBAAY;;AAFJ,KAHP;;AASL;;AAEAC,UAXK,oBAWK,CAET,CAbI;;;AAeL;AACAC,cAhBK,sBAgBMC,QAhBN,EAgBgB;;AAEjB,YAAI,KAAKC,UAAL,IAAmB,IAAvB,EAA6B;AACzB,iBAAKA,UAAL,GAAkB,KAAKC,IAAL,CAAUC,YAAV,CAAuB,YAAvB,CAAlB;AACH;;AAED,YAAIb,GAAGc,GAAH,CAAOC,SAAX,EAAsB;AAClB,iBAAKC,SAAL,CAAeN,QAAf;AACH,SAFD,MAEM,IAAIO,MAAJ,EAAY;AACd,iBAAKC,YAAL,CAAkBR,QAAlB;AACH;AAEJ,KA5BI;AA8BLM,aA9BK,qBA8BKN,QA9BL,EA8Be;AAAA;;AAChB,aAAKC,UAAL,CAAgBQ,gBAAhB,CAAiC,UAACC,MAAD,EAAQC,KAAR,EAAkB;AAC/C,kBAAKD,MAAL,GAAcA,MAAd;AACA,kBAAKf,IAAL,CAAUiB,WAAV,GAAwBD,KAAxB;AACAX;AACH,SAJD;AAKH,KApCI;AAsCLQ,gBAtCK,wBAsCQR,QAtCR,EAsCkB;AAAA;;AACnB,aAAKH,SAAL,GAAiB,KAAKA,SAAL,GAAiB,CAAlC;AACA,YAAIgB,OAAO,SAAS,KAAKhB,SAAL,CAAeiB,QAAf,EAAT,GAAqC,MAAhD;;AAEA,aAAKb,UAAL,CAAgBc,gBAAhB,CAAiCF,IAAjC,EAAuC,KAAvC,EAA8C,iBAAS;AACnD,mBAAKlB,IAAL,CAAUiB,WAAV,GAAwBD,KAAxB;AACAX;AACH,SAHD;AAIH,KA9CI;;;AAgDLgB,YAAS,kBAAW;AAChB,aAAKd,IAAL,CAAUe,MAAV,GAAmB,KAAnB;AACH,KAlDI;;AAqDL;AACAC,qBAAkB,yBAAUC,CAAV,EAAYC,IAAZ,EAAiB;;AAE/BC,aAAKC,OAAL,CAAa,OAAb,EAAsBF,IAAtB;;AAEA,YAAGG,OAAOC,MAAP,IAAeA,OAAOC,EAAzB,EAA4B;AACxB;AACAD,mBAAOC,EAAP;AACH,SAHD,MAGM,IAAIlB,MAAJ,EAAY;AACd,gBAAImB,WAAW,SAAS,KAAK7B,SAAL,CAAeiB,QAAf,EAAT,GAAqC,MAApD;AACA,gBAAIa,WAAWC,IAAIC,SAAJ,CAAcC,eAAd,KAAkCJ,QAAjD;AACA,gBAAIK,OAAOC,KAAKC,SAAL,CAAe,EAAC,OAAQN,QAAT,EAAkB,QAASP,IAA3B,EAAf,CAAX;AACA,gBAAIc,SAASN,IAAIO,UAAJ,CAAeC,gBAAf,CAAgC,OAAhC,EAAwC,gBAAxC,EAAyDL,IAAzD,CAAb;AACH,SALK,MAKA,IAAGzC,GAAGc,GAAH,CAAOC,SAAV,EAAoB;AACtB,gBAAIgC,MAAM,IAAV,EAAgB;AACZ,oBAAIC,OAAO,IAAX;AACAD,mBAAGE,gBAAH,CAAoB,KAAK7B,MAAzB,EAAiC,UAAS8B,SAAT,EAAoB;AACjDF,yBAAKE,SAAL,GAAiBA,SAAjB;AACA,wBAAIT,OAAOC,KAAKC,SAAL,CAAe,EAAC,OAAQK,KAAKE,SAAd,EAAwB,QAASpB,IAAjC,EAAf,CAAX;AACAiB,uBAAGI,aAAH,CAAiBV,IAAjB;AACH,iBAJD;AAKH;AACJ;AACJ,KA5EI;;AA+EL;AACAW,iBAAc,uBAAW;;AAErBrB,aAAKC,OAAL,CAAa,MAAb;;AAEA,YAAGC,OAAOC,MAAP,IAAeA,OAAOC,EAAzB,EAA4B;AACxB;AACAD,mBAAOC,EAAP;AACH,SAHD,MAGM,IAAIlB,MAAJ,EAAY;AACd;AACA,gBAAImB,WAAW,SAAS,KAAK7B,SAAL,CAAeiB,QAAf,EAAT,GAAqC,MAApD;AACA,gBAAIa,WAAWC,IAAIC,SAAJ,CAAcC,eAAd,KAAkCJ,QAAjD;AACA,gBAAIQ,SAASN,IAAIO,UAAJ,CAAeC,gBAAf,CAAgC,OAAhC,EAAwC,cAAxC,EAAuDT,QAAvD,CAAb;AACH,SALK,MAKA,IAAGrC,GAAGc,GAAH,CAAOC,SAAV,EAAoB;AACtB;AACA,gBAAIgC,MAAM,IAAV,EAAgB;AACZA,mBAAGM,gBAAH,CAAoB,KAAKjC,MAAzB,EAAiC,UAAS8B,SAAT,EAAoB;AACjD,wBAAIA,UAAUI,MAAV,GAAmB,CAAvB,EAA0B;AACtBP,2BAAGQ,KAAH,CAAS,MAAT;AACH,qBAFD,MAEK;AACDR,2BAAGQ,KAAH,CAAS,MAAT;AACH;AACJ,iBAND;AAOH;AACJ;AACJ;;AAED;AA1GK,CAAT","file":"ShareView.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        shot: cc.Sprite,\n        shotIndex : 0,\n        \n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        \n    },\n\n    //截屏\n    screenShot(callback) {\n\n        if (this.screenshot == null) {\n            this.screenshot = this.node.addComponent('Screenshot');\n        }\n\n        if (cc.sys.isBrowser) {\n            this.onbtn_web(callback);\n        }else if (CC_JSB) {\n            this.onBtn_native(callback);\n        }\n        \n    },\n\n    onbtn_web(callback) {\n        this.screenshot.screenshotCanvas((base64,frame) => {\n            this.base64 = base64\n            this.shot.spriteFrame = frame\n            callback()\n        });\n    },\n\n    onBtn_native(callback) {\n        this.shotIndex = this.shotIndex + 1;\n        var name = 'test' + this.shotIndex.toString() + '.png'\n\n        this.screenshot.screenshotNative(name, 'low', frame => {\n            this.shot.spriteFrame = frame;\n            callback();\n        });\n    },\n\n    hidden : function (){\n        this.node.active = false;\n    },\n\n\n    //分享\n    shareToPlatform : function (t,type){\n\n        Tool.onEvent('Share', type);\n\n        if(window.system&&system.go){\n            //快应用\n            system.go(`/download`)\n        }else if (CC_JSB) {\n            var fileName = 'test' + this.shotIndex.toString() + '.png'\n            var fullPath = jsb.fileUtils.getWritablePath() + fileName;\n            var info = JSON.stringify({'pic' : fullPath,'type' : type }) \n            var result = jsb.reflection.callStaticMethod(\"Tools\",\"shareByClient:\",info);\n        }else if(cc.sys.isBrowser){\n            if (kf != null) {\n                var self = this\n                kf.saveImageToLocal(this.base64, function(imagePath) {\n                    self.imagePath = imagePath\n                    var info = JSON.stringify({'pic' : self.imagePath,'type' : type }) \n                    kf.shareByClient(info)\n                } )\n            }\n        }\n    },\n\n\n    //保存相册\n    saveToAlbum : function (){\n\n        Tool.onEvent('Save');\n        \n        if(window.system&&system.go){\n            //快应用\n            system.go(`/download`)\n        }else if (CC_JSB) {\n            //native\n            var fileName = 'test' + this.shotIndex.toString() + '.png'\n            var fullPath = jsb.fileUtils.getWritablePath() + fileName;\n            var result = jsb.reflection.callStaticMethod(\"Tools\",\"saveToAlbum:\",fullPath);\n        }else if(cc.sys.isBrowser){\n            //web native\n            if (kf != null) {\n                kf.saveImageToAlbum(this.base64, function(imagePath) {\n                    if (imagePath.length > 0) {\n                        kf.toast('保存成功')\n                    }else{\n                        kf.toast('保存失败')\n                    }\n                } )\n            }\n        }\n    },\n\n    // update (dt) {},\n});\n\n"]}